import gensim
import pandas as pd
import numpy as np
import gensim.downloader as api
from sklearn.preprocessing import minmax_scale
from sklearn.metrics.pairwise import cosine_similarity
import gensim.models.fasttext as ft


vectors = ft.load_facebook_vectors('./models/wiki.uk.bin')
# vectors = ft.load_facebook_vectors('./models/cc.uk.300.bin')

# ukr_words = ['машина', 'колесо', 'автомобіль', 'літак', 'небо',"вовк", "лиса", "заєць", "казка", "легенда", "байка", "оповідання", "повість", "балада", "інформатика", "математика", "індустрія", "дельтаплан"]

# lemmatized
# ukr_words = [
#     "предмет",
#     "предмет",
#     "інформатика",
#     "розвиток",
#     "індустрія",
#     "протяг",
#     "десятка",
#     "рік",
#     "процес",
#     "самовизначення",
#     "самовизначення",
#     "інформатика",
#     "наука",
#     "боротьба",
#     "полюс",
#     "підґрунтя",
#     "аспект",
#     "процес",
#     "обробка",
#     "процес",
#     "обробка",
#     "інформація",
#     "обробка",
#     "інформація",
#     "так",
#     "підхід",
#     "інженерний",
#     "підхід",
#     "система",
#     "період",
#     "становлення",
#     "становлення",
#     "інформатика",
#     "коли",
#     "комп'ютерний",
#     "система",
#     "як",
#     "приклад",
#     "думка",
#     "предмет",
#     "інформатика",
#     "вивчення",
#     "інформатика",
#     "вивчення",
#     "вивчення",
#     "машина",
#     "комплекс",
#     "проблема",
#     "проектування",
#     "розробка",
#     "під",
#     "відомий",
#     "під",
#     "назва",
#     "загальний",
#     "назва",
#     "інженерія",
#     "план",
#     "проблема",
#     "взаємодія",
#     "суб'єкт",
#     "середина",
#     "комунікативний",
#     "процес",
#     "математичний",
#     "підхід",
#     "проникнення",
#     "тотальний",
#     "проникнення",
#     "технологія",
#     "сфера",
#     "сфера",
#     "життя",
#     "сфера",
#     "життя",
#     "суспільство",
#     "життя",
#     "життя",
#     "суспільство",
#     "підвищення",
#     "підвищення",
#     "різкий",
#     "підвищення",
#     "підвищення",
#     "проблема",
#     "підвищення",
#     "проблема",
#     "підвищення",
#     "продуктивність",
#     "праця",
#     "галузь",
#     "продукування",
#     "підвищення",
#     "надійність",
#     "технологія",
#     "надійність",
#     "зниження",
#     "суттєвий",
#     "зниження",
#     "вартість",
#     "мова",
#     "запровадження",
#     "метод",
#     "виробництво",
#     "комп'ютер",
#     "забезпечення",
#     "програмний",
#     "забезпечення",
#     "подібний",
#     "виробництво",
#     "автоматизація",
#     "підтримка",
#     "математичний",
#     "підтримка",
#     "ряд",
#     "цілий",
#     "ряд",
#     "розділ",
#     "математика",
#     "математика",
#     "логіка",
#     "логіка",
#     "семіотика",
#     "лінгвістика",
#     "документація",
#     "експлуатація",
#     "експлуатація",
#     "система",
#     "підстава",
#     "дата",
#     "вовк",
#     "лиса",
#     "заєць",
#     "казка",
#     "легенда",
#     "байка",
#     "оповідання",
#     "повість",
#     "балада",
#     "мультфільм",
#     "коза-дереза",
#     "колобок",
#     "поема",
#     "вірш",
#     "літак",
#     "вертоліт",
#     "гелікоптер",
#     "планер",
#     "аеробус",
#     "як-40",
#     "бомбардувальник",
#     "авіатехнік",
#     "дельтаплан",
# ]

# non-lemmatized
ukr_words = [
    "предмет",
    "предмет",
    "інформатики",
    "інформатика",
    "розвиток",
    "індустрії",
    "протяг",
    "десятки",
    "рік",
    "процес",
    "самовизначення",
    "самовизначення",
    "інформатики",
    "наука",
    "боротьба",
    "полюси",
    "підґрунтя",
    "аспекти",
    "процеси",
    "обробки",
    "процеси",
    "обробки",
    "інформації",
    "обробка",
    "обробки",
    "інформації",
    "інформація",
    "таки",
    "підхід",
    "інженерний",
    "підхід",
    "система",
    "період",
    "становлення",
    "становлення",
    "інформатики",
    "коли",
    "комп'ютерні",
    "системи",
    "як",
    "приклад",
    "думка",
    "предмет",
    "інформатики",
    "вивчення",
    "інформатика",
    "вивчення",
    "вивчення",
    "машини",
    "комплекс",
    "проблема",
    "проектування",
    "розробка",
    "під",
    "відомий",
    "під",
    "назва",
    "загальна",
    "назва",
    "інженерія",
    "план",
    "проблеми",
    "взаємодії",
    "взаємодія",
    "суб'єкт",
    "середина",
    "комунікативний",
    "процес",
    "математичний",
    "підхід",
    "проникнення",
    "тотальне",
    "проникнення",
    "технології",
    "ycі",
    "сфери",
    "сфери",
    "життя",
    "сфери",
    "життя",
    "суспільства",
    "життя",
    "життя",
    "суспільства",
    "суспільство",
    "підвищення",
    "підвищення",
    "продуктивності",
    "різке",
    "підвищення",
    "різке",
    "підвищення",
    "продуктивності",
    "проблема",
    "різкого",
    "підвищення",
    "проблема",
    "різкого",
    "підвищення",
    "продуктивності",
    "продуктивність",
    "праці",
    "галузі",
    "продукування",
    "підвищення",
    "надійності",
    "технології",
    "надійності",
    "надійність",
    "зниження",
    "суттєве",
    "зниження",
    "вартості",
    "мова",
    "ід",
    "запровадження",
    "методи",
    "індустріальні",
    "методи",
    "виробництво",
    "комп'ютери",
    "забезпечення",
    "програмне",
    "забезпечення",
    "подібне",
    "виробництво",
    "автоматизація",
    "підтримка",
    "математична",
    "підтримка",
    "ряд",
    "цілий",
    "ряд",
    "розділи",
    "розділи",
    "математики",
    "розділи",
    "логіки",
    "математика",
    "логіка",
    "математична",
    "логіка",
    "семіотика",
    "лінгвістика",
    "математична",
    "лінгвістика",
    "тенденція",
    "переварювання",
    "засвоєння",
    "результати",
    "дисципліна",
    "пошук",
    "активний",
    "пошук",
    "активне",
    "формування",
    "формування",
    "основи",
    "створення",
    "фундамент",
    "власний",
    "фундамент",
    "задачі",
    "сучасна",
    "інформатика",
    "задачі",
    "сучасної",
    "інформатики",
    "потреби",
    "вона",
    "предмет",
    "науки",
    "предмет",
    "науки",
    "інформатики",
    "науки",
    "інформатики",
    "енциклопедія",
    "кібернетик",
    "терени",
    "СРСР",
    "термін",
    "структура",
    "властивості",
    "наукова",
    "інформація",
    "властивості",
    "наукової",
    "інформації",
    "закономірності",
    "комунікація",
    "наукова",
    "комунікація",
    "обмін",
    "допомога",
    "керування",
    "привод",
    "точка",
    "зір",
    "спосіб",
    "алгоритми",
    "академік",
    "АН",
    "фундаментальна",
    "наука",
    "назва",
    "фундаментальної",
    "науки",
    "назва",
    "природничої",
    "науки",
    "природнича",
    "наука",
    "фундаментальна",
    "природнича",
    "наука",
    "назва",
    "фундаментальної",
    "природничої",
    "науки",
    "процеси",
    "передачі",
    "передачі",
    "процеси",
    "інформації",
    "спеціалісти",
    "французькі",
    "спеціалісти",
    "варіанти",
    "варіанти",
    "означення",
    "варіанти",
    "означення",
    "інформатики",
    "означення",
    "означення",
    "інформатики",
    "Computer",
    "Scіence",
    "підручник",
    "академія",
    "французька",
    "академія",
    "чин",
    "головний",
    "чин",
    "засоби",
    "автоматичні",
    "засоби",
    "повідомлення",
    "область",
    "джерела",
    "комп'ютерні",
    "методи",
    "розв'язання",
    "том",
    "число",
    "книга",
    "різноманіття",
    "визначення",
    "самоідентифікація",
    "наукова",
    "дисципліна",
    "звичай",
    "кіл",
    "тога",
    "точна",
    "наука",
    "справа",
    "моделі",
    "явища",
    "фізик",
    "хімія",
    "моделі",
    "систем",
    "питання",
    "ухо",
    "наявність",
    "елементи",
    "наступні",
    "елементи",
    "сукупність",
    "певна",
    "сукупність",
    "об'єкти",
    "інформаційні",
    "об'єкти",
    "Подібна",
    "простір",
    "етапи",
    "цикл",
    "життєвий",
    "цикл",
    "співвідношення",
    "обробник",
    "запит",
    "певна",
    "інформація",
    "вхідна",
    "інформація",
    "певна",
    "вхідна",
    "інформація",
    "поряд",
    "мет",
    "вигляд",
    "вимоги",
    "вихідна",
    "інформація",
    "опис",
    "детальний",
    "опис",
    "набір",
    "набір",
    "дескрипцій",
    "певний",
    "набір",
    "певний",
    "набір",
    "дескрипцій",
    "дескрипції",
    "прогри",
    "межі",
    "інтервал",
    "часовий",
    "інтервал",
    "дії",
    "реалізації",
    "правило",
    "момент",
    "час",
    "стан",
    "предметна",
    "область",
    "об'єкти",
    "предметної",
    "області",
    "аналог",
    "комунікативні",
    "системи",
    "ЖЦ",
    "аналіз",
    "специфікації",
    "побудова",
    "побудова",
    "системи",
    "проектування",
    "системи",
    "обґрунтування",
    "коректність",
    "документація",
    "експлуатація",
    "експлуатація",
    "системи",
    "підстава",
    "дати",
    "вовк",
    "лиса",
    "заєць",
    "казка",
    "легенда",
    "байка",
    "оповідання",
    "повість",
    "балада",
    "мультфільм",
    "коза-дереза",
    "колобок",
    "поема",
    "вірш",
    "літак",
    "вертоліт",
    "гелікоптер",
    "планер",
    "аеробус",
    "як-40",
    "бомбардувальник",
    "авіатехнік",
    "дельтаплан"
]

words_vectors = np.array([vectors[x] for x in ukr_words])
vectors = minmax_scale(words_vectors, feature_range=(0, 1))

def get_sim_matrix(X, threshold=0.99):
    """Output pairwise cosine similarities in X. Cancel out the bottom
    `threshold` percent of the pairs sorted by similarity.
    """
    sim_matrix = cosine_similarity(X)
    np.fill_diagonal(sim_matrix, 0.0)

    sorted_sims = np.sort(sim_matrix.flatten())
    thr_val = sorted_sims[int(sorted_sims.shape[0]*threshold)]
    sim_matrix[sim_matrix < thr_val] = 0.0

    return sim_matrix

def majorclust(sim_matrix):
    """Actual MajorClust algorithm
    """
    t = False
    indices = np.arange(sim_matrix.shape[0])
    while not t:
        t = True
        for index in np.arange(sim_matrix.shape[0]):
            # check if all the sims of the word are not zeros
            weights = sim_matrix[index]
            if weights[weights > 0.0].shape[0] == 0:
                continue
            # aggregating edge weights
            new_index = np.argmax(np.bincount(indices, weights=weights))
            if indices[new_index] != indices[index]:
                indices[index] = indices[new_index]
                t = False
    return indices

sim_matrix = get_sim_matrix(vectors, 0.99)
labels = majorclust(sim_matrix)
word2clusters = dict(zip(ukr_words, labels))

print(word2clusters)